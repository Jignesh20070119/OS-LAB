#include <stdio.h>
#include <string.h>

struct File { char fname[20]; int inUse; };
struct User { char uname[20]; struct File files[10]; int inUse; } users[5];

int main() {
    int ch,i,j; char uname[20], fname[20];
    for(i=0;i<5;i++){ users[i].inUse=0; for(j=0;j<10;j++) users[i].files[j].inUse=0; }

    while(1){
        printf("\n1.Create User 2.Create File 3.Delete File 4.Search File 5.Display 6.Exit\nChoice: ");
        scanf("%d",&ch);

        if(ch==1){ 
            printf("User: "); scanf("%s",uname);
            for(i=0;i<5 && !(users[i].inUse && !strcmp(users[i].uname,uname));i++);
            if(i<5 && users[i].inUse){ printf("User exists!\n"); continue; }
            for(i=0;i<5 && users[i].inUse;i++);
            if(i==5) printf("Max users!\n"); else { strcpy(users[i].uname,uname); users[i].inUse=1; printf("User created.\n"); }
        }
        else if(ch==2){ // Create File
            printf("User: "); scanf("%s",uname);
            for(i=0;i<5 && !(users[i].inUse && !strcmp(users[i].uname,uname));i++);
            if(i==5){ printf("User not found!\n"); continue; }
            printf("File: "); scanf("%s",fname);
            for(j=0;j<10 && !(users[i].files[j].inUse && !strcmp(users[i].files[j].fname,fname));j++);
            if(j<10 && users[i].files[j].inUse){ printf("File exists!\n"); continue; }
            for(j=0;j<10 && users[i].files[j].inUse;j++);
            if(j==10) printf("Dir full!\n"); else { strcpy(users[i].files[j].fname,fname); users[i].files[j].inUse=1; printf("File created.\n"); }
        }
        else if(ch==3){ 
            printf("User: "); scanf("%s",uname);
            for(i=0;i<5 && !(users[i].inUse && !strcmp(users[i].uname,uname));i++);
            if(i==5){ printf("User not found!\n"); continue; }
            printf("File: "); scanf("%s",fname);
            for(j=0;j<10 && !(users[i].files[j].inUse && !strcmp(users[i].files[j].fname,fname));j++);
            if(j==10) printf("File not found!\n"); else { users[i].files[j].inUse=0; printf("File deleted.\n"); }
        }
        else if(ch==4){
            printf("User: "); scanf("%s",uname);
            for(i=0;i<5 && !(users[i].inUse && !strcmp(users[i].uname,uname));i++);
            if(i==5){ printf("User not found!\n"); continue; }
            printf("File: "); scanf("%s",fname);
            for(j=0;j<10 && !(users[i].files[j].inUse && !strcmp(users[i].files[j].fname,fname));j++);
            if(j==10) printf("File not found!\n"); else printf("Found: %s/%s\n",uname,fname);
        }
        else if(ch==5){
            for(i=0;i<5;i++) if(users[i].inUse){ 
                printf("User: %s\n",users[i].uname);
                for(j=0;j<10;j++) if(users[i].files[j].inUse) printf("  %s\n",users[i].files[j].fname);
            }
        }
        else if(ch==6) break;
    }
    return 0;
}
